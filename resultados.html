<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resultados de la Encuesta | E-Skate S.A</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="menu-icon" id="menuIcon">
        <i class="fas fa-bars"></i>
    </div>

    <nav class="mobile-nav-overlay" id="mobileNavOverlay">
        <div class="mobile-nav-header">
            <h2 class="mobile-nav-category-title">Menú</h2>
        </div>
        <div class="mobile-nav-section">
            <h3 class="mobile-nav-category-title">Navegación Principal</h3>
            <ul class="mobile-nav-list">
                <li><a href="index.html#hero-section" class="mobile-nav-item"><i class="fas fa-home"></i> Inicio</a></li>
                <li><a href="index.html#survey-section" class="mobile-nav-item"><i class="fas fa-poll-h"></i> Encuesta</a></li>
                <li><a href="#charts-section" class="mobile-nav-item"><i class="fas fa-chart-bar"></i> Resultados</a></li>
                <li><a href="analisisCompetencia.html" class="mobile-nav-item"><i class="fas fa-balance-scale"></i> Competencia</a></li>
            </ul>
        </div>
        <div class="mobile-nav-section">
            <h3 class="mobile-nav-category-title">Contenido de Resultados</h3>
            <ul class="mobile-nav-list">
                <li><a href="#charts-section" class="mobile-nav-item"><i class="fas fa-chart-bar"></i> Gráficos Clave</a></li>
                <li><a href="#analysis-section" class="mobile-nav-item"><i class="fas fa-book-open"></i> Análisis Detallado</a></li>
            </ul>
        </div>
    </nav>

    <aside class="sidebar sidebar-right">
        <a href="index.html#hero-section" class="sidebar-item">
            <i class="fas fa-home"></i>
            <span class="custom-tooltip">Inicio</span>
        </a>
        <a href="index.html#survey-section" class="sidebar-item">
            <i class="fas fa-poll-h"></i>
            <span class="custom-tooltip">Encuesta</span>
        </a>
        <a href="#charts-section" class="sidebar-item">
            <i class="fas fa-chart-bar"></i>
            <span class="custom-tooltip">Resultados</span>
        </a>
        <a href="analisisCompetencia.html" class="sidebar-item">
            <i class="fas fa-balance-scale"></i>
            <span class="custom-tooltip">Análisis de la Competencia</span>
        </a>
    </aside>

    <header>
        <div class="container">
            <h1>Resultados Detallados</h1>
            <p class="tagline">Análisis Exhaustivo de Nuestro Sondeo de Viabilidad</p>
        </div>
    </header>

    <main>
        <section id="charts-section" class="section-padded content-section">
            <div class="container">
                <h2>Perspectivas Clave de la Encuesta</h2>
                <p class="description">Descubre los patrones y tendencias que emergen de las respuestas de nuestros participantes.</p>
                <div class="chart-grid">
                    <div class="chart-card">
                        <h3>Distribución Demográfica (Edad)</h3>
                        <canvas id="edadChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>Hábitos de Movilidad Actuales</h3>
                        <canvas id="vehiculoChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>Interés en el Rastreo GPS</h3>
                        <canvas id="rastreoChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>Disposición de Inversión (USD)</h3>
                        <canvas id="pagoChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>Visión de Futuro: Aplicabilidad</h3>
                        <canvas id="expandirChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>Sentimiento sobre Inseguridad por Robo</h3>
                        <canvas id="inseguridadChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>Factores de Decisión (Importancia)</h3>
                        <canvas id="factoresChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <section id="analysis-section" class="section-padded accent-bg">
            <div class="container">
                <h2>Conclusiones Estratégicas y Próximos Pasos</h2>
                <div class="analysis-summary">
                    <p class="description">
                        La encuesta ha revelado insights críticos. Un total de <strong id="totalParticipantesText">-- participantes</strong> nos brindaron su valiosa perspectiva, conformando un grupo demográfico predominantemente joven.
                    </p>
                    <p class="description">
                        Un hallazgo significativo es que el <strong id="interesRastreoText">--% de los encuestados</strong> ha expresado interés en poder ver la ubicación y otros datos de su vehículo a través de una aplicación o sitio web.
                    </p>
                    <p class="description">
                        Financieramente, el proyecto muestra una gran viabilidad: el <strong id="pago300500Text">--% de los participantes</strong> estaría dispuesto a invertir entre 300 y 500 USD en el sistema E-Skate, y otro <strong id="pago0300Text">--% está dispuesto a pagar entre 0 y 300 USD</strong>.
                    </p>
                    <p class="description">
                        La visión a futuro es aún más ambiciosa, con el <strong id="expandirText">--% de los encuestados</strong> creyendo que nuestro sistema podría aplicarse a una amplia gama de vehículos.
                    </p>
                    <p class="description">
                        Finalmente, recibimos comentarios valiosos como la sugerencia de comprar un dominio propio y hostear en servidores cercanos (ej. AWS Brasil) para optimizar la respuesta de la página, lo que tomaremos en cuenta para la infraestructura futura. Estos resultados nos motivan a avanzar con el desarrollo, enfocándonos en robustez, usabilidad y escalabilidad para satisfacer esta demanda latente en el mercado de movilidad inteligente.
                    </p>
                </div>
                <div class="text-center button-group-analysis">
                    <a href="index.html#survey-section" class="btn-primary">Volver a la Encuesta</a>
                    <a href="index.html" class="btn-primary">Volver a la Página Principal</a>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 E-Skate Project. Todos los derechos reservados.</p>
        </div>
    </footer>

    <script>
        // Tu código JavaScript para los gráficos y la obtención de datos del CSV (SIN CAMBIOS)
        // ... (todo el script de Chart.js y datos) ...
        const chartColors = {
            primary: '#FFCC00',
            secondary: '#0F2D52',
            tertiary: '#1A1A2E',
            quaternary: '#4CAF50',
            fifth: '#00BCD4',
            sixth: '#FF5722'
        };

        function getChartBackgroundColors(count) {
            const colors = [
                chartColors.primary, chartColors.secondary, chartColors.quaternary, chartColors.fifth,
                chartColors.tertiary, chartColors.sixth, '#3F51B5', '#8BC34A', '#FF9800', '#F44336'
            ];
            return colors.slice(0, count);
        }

        const commonChartOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        font: {
                            family: 'Poppins',
                            size: 14
                        },
                        color: '#E0E0E0'
                    }
                },
                tooltip: {
                    bodyFont: {
                        family: 'Poppins',
                        size: 14
                    },
                    titleFont: {
                        family: 'Poppins',
                        weight: 'bold',
                        size: 16
                    },
                    backgroundColor: 'rgba(15, 45, 82, 0.9)',
                    borderColor: chartColors.primary,
                    borderWidth: 1,
                    cornerRadius: 8,
                    xPadding: 15,
                    yPadding: 15
                }
            },
            animation: {
                animateScale: true,
                animateRotate: true
            }
        };

        const GOOGLE_SHEET_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQUxhn2MDgcTc5gtbZUtzpe9hyBwvIeCez3eQB0HAJjOJG2QE0HbLisj4nmz9MiU7kfPmOv7gb_wSNY/pub?output=csv';

        let edadChart, vehiculoChart, rastreoChart, pagoChart, expandirChart, inseguridadChart, factoresChart;

        async function fetchAndProcessData() {
            try {
                const response = await fetch(GOOGLE_SHEET_CSV_URL);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const csvText = await response.text();

                const lines = csvText.trim().split('\n');

                const parseCSVLine = (line) => {
                    const values = [];
                    let inQuote = false;
                    let currentField = '';
                    for (let i = 0; i < line.length; i++) {
                        const char = line[i];
                        if (char === '"') {
                            inQuote = !inQuote;
                        } else if (char === ',' && !inQuote) {
                            values.push(currentField.trim());
                            currentField = '';
                        } else {
                            currentField += char;
                        }
                    }
                    values.push(currentField.trim());
                    return values.map(val => {
                        if (val.startsWith('"') && val.endsWith('"')) {
                            return val.substring(1, val.length - 1).replace(/""/g, '"');
                        }
                        return val;
                    });
                };

                const headers = parseCSVLine(lines[0]);
                const data = lines.slice(1).map(line => {
                    const values = parseCSVLine(line);
                    let obj = {};
                    headers.forEach((header, i) => {
                        obj[header] = values[i] ? values[i].trim() : '';
                    });
                    return obj;
                });

                console.log("Datos brutos de la encuesta:", data);
                console.log("Encabezados de columna:", headers);

                const totalParticipantes = data.length;

                let edad_15_18 = 0;
                let edad_18_30 = 0;
                let edad_30_plus = 0;
                data.forEach(row => {
                    const edadStr = row['¿Qué edad tienes?'] || '';
                    if (edadStr.includes('15 a 18 años')) {
                        edad_15_18++;
                    } else if (edadStr.includes('18 a 30 años')) {
                        edad_18_30++;
                    } else if (parseInt(edadStr, 10) > 30) {
                        edad_30_plus++;
                    }
                });

                let vehiculoCounts = {};
                data.forEach(row => {
                    const vehiculo = row['¿Tienes vehículo propio?'] || '';
                    if (vehiculo) {
                       vehiculoCounts[vehiculo] = (vehiculoCounts[vehiculo] || 0) + 1;
                    }
                });
                const vehiculoLabels = Object.keys(vehiculoCounts);
                const vehiculoData = Object.values(vehiculoCounts);

                let rastreoSi = 0;
                let rastreoNo = 0;
                data.forEach(row => {
                    const rastreo = row['¿Te gustaría poder ver la ubicación y otros datos de tu vehículo a través de una aplicación o sitio web?'] || '';
                    if (rastreo === 'Si') {
                        rastreoSi++;
                    } else if (rastreo === 'No') {
                        rastreoNo++;
                    }
                });
                const porcentajeInteresRastreo = totalParticipantes > 0 ? ((rastreoSi / totalParticipantes) * 100).toFixed(0) : 0;


                let pago_0_300 = 0;
                let pago_300_500 = 0;
                let pago_mas_500 = 0;
                let pago_no_esp = 0;
                data.forEach(row => {
                    const pago = row['¿Cuánto estarías dispuesto a pagar por este producto?'] || '';
                    if (pago === '0-300 USD') pago_0_300++;
                    else if (pago === '300-500 USD') pago_300_500++;
                    else if (pago === 'Mas de 500 USD') pago_mas_500++;
                    else pago_no_esp++;
                });
                const porcentajePago300500 = totalParticipantes > 0 ? ((pago_300_500 / totalParticipantes) * 100).toFixed(0) : 0;
                const porcentajePago0300 = totalParticipantes > 0 ? ((pago_0_300 / totalParticipantes) * 100).toFixed(0) : 0;


                let expandirQuiero = 0;
                let expandirPosible = 0;
                let expandirNo = 0;
                data.forEach(row => {
                    const expandir = row['¿Te gustaría que se expanda a todo tipo de vehículos?'] || '';
                    if (expandir === 'Quiero tenerlo en todos mis vehículos') expandirQuiero++;
                    else if (expandir === 'Lo veo posible') expandirPosible++;
                    else if (expandir === 'No') expandirNo++;
                });
                const porcentajeExpandir = totalParticipantes > 0 ? (((expandirQuiero + expandirPosible) / totalParticipantes) * 100).toFixed(0) : 0;


                let inseguroSi = 0;
                let inseguroNo = 0;
                data.forEach(row => {
                    const inseguridad = row['¿Te sientes inseguro de darle a tu hijo un vehículo propio a causa de este peligro de robo?'] || '';
                    if (inseguridad === 'Si') inseguroSi++;
                    else if (inseguridad === 'No') inseguroNo++;
                });


                const edadCtx = document.getElementById('edadChart').getContext('2d');
                if (edadChart) {
                    edadChart.data.datasets[0].data = [edad_15_18, edad_18_30, edad_30_plus];
                    edadChart.update();
                } else {
                    edadChart = new Chart(edadCtx, {
                        type: 'pie',
                        data: {
                            labels: ['15-18 años', '18-30 años', '30+ años'],
                            datasets: [{
                                data: [edad_15_18, edad_18_30, edad_30_plus],
                                backgroundColor: getChartBackgroundColors(3),
                                hoverOffset: 10
                            }]
                        },
                        options: commonChartOptions
                    });
                }

                const vehiculoCtx = document.getElementById('vehiculoChart').getContext('2d');
                if (vehiculoChart) {
                    vehiculoChart.data.labels = vehiculoLabels;
                    vehiculoChart.data.datasets[0].data = vehiculoData;
                    vehiculoChart.data.datasets[0].backgroundColor = getChartBackgroundColors(vehiculoLabels.length);
                    vehiculoChart.update();
                } else {
                    vehiculoChart = new Chart(vehiculoCtx, {
                        type: 'pie',
                        data: {
                            labels: vehiculoLabels,
                            datasets: [{
                                data: vehiculoData,
                                backgroundColor: getChartBackgroundColors(vehiculoLabels.length),
                                hoverOffset: 10
                            }]
                        },
                        options: commonChartOptions
                    });
                }

                const rastreoCtx = document.getElementById('rastreoChart').getContext('2d');
                if (rastreoChart) {
                    rastreoChart.data.labels = ['Sí, me gustaría verlo', 'No, no me gustaría'];
                    rastreoChart.data.datasets[0].data = [rastreoSi, rastreoNo];
                    rastreoChart.data.datasets[0].backgroundColor = [chartColors.primary, chartColors.secondary];
                    rastreoChart.update();
                } else {
                    rastreoChart = new Chart(rastreoCtx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Sí, me gustaría verlo', 'No, no me gustaría'],
                            datasets: [{
                                data: [rastreoSi, rastreoNo],
                                backgroundColor: [chartColors.primary, chartColors.secondary],
                                hoverOffset: 10
                            }]
                        },
                        options: commonChartOptions
                    });
                }

                const pagoCtx = document.getElementById('pagoChart').getContext('2d');
                const pagoLabels = ['0-300 USD', '300-500 USD', 'Más de 500 USD'];
                const pagoChartData = [pago_0_300, pago_300_500, pago_mas_500];
                const pagoColors = getChartBackgroundColors(3);

                if (pago_no_esp > 0) {
                    pagoLabels.push('No especificó');
                    pagoChartData.push(pago_no_esp);
                    pagoColors.push('#B0BEC5');
                }

                if (pagoChart) {
                    pagoChart.data.labels = pagoLabels;
                    pagoChart.data.datasets[0].data = pagoChartData;
                    pagoChart.data.datasets[0].backgroundColor = pagoColors;
                    pagoChart.update();
                } else {
                    pagoChart = new Chart(pagoCtx, {
                        type: 'pie',
                        data: {
                            labels: pagoLabels,
                            datasets: [{
                                data: pagoChartData,
                                backgroundColor: pagoColors,
                                hoverOffset: 10
                            }]
                        },
                        options: commonChartOptions
                    });
                }

                const expandirCtx = document.getElementById('expandirChart').getContext('2d');
                const expandirLabels = ['Quiero tenerlo en todos mis vehículos', 'Lo veo posible'];
                const expandirChartData = [expandirQuiero, expandirPosible];
                const expandirColors = getChartBackgroundColors(2);

                if (expandirNo > 0) {
                    expandirLabels.push('No');
                    expandirChartData.push(expandirNo);
                    expandirColors.push('#B0BEC5');
                }

                if (expandirChart) {
                    expandirChart.data.labels = expandirLabels;
                    expandirChart.data.datasets[0].data = expandirChartData;
                    expandirChart.data.datasets[0].backgroundColor = expandirColors;
                    expandirChart.update();
                } else {
                    expandirChart = new Chart(expandirCtx, {
                        type: 'pie',
                        data: {
                            labels: expandirLabels,
                            datasets: [{
                                data: expandirChartData,
                                backgroundColor: expandirColors,
                                hoverOffset: 10
                            }]
                        },
                        options: commonChartOptions
                    });
                }

                const inseguridadCtx = document.getElementById('inseguridadChart').getContext('2d');
                if (inseguridadChart) {
                    inseguridadChart.data.datasets[0].data = [inseguroSi, inseguroNo];
                    inseguridadChart.update();
                } else {
                    inseguridadChart = new Chart(inseguridadCtx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Sí, me sentiría mucho más seguro/a', 'No, no me sentiría inseguro/a'],
                            datasets: [{
                                data: [inseguroSi, inseguroNo],
                                backgroundColor: [chartColors.quaternary, chartColors.sixth],
                                hoverOffset: 10
                            }]
                        },
                        options: commonChartOptions
                    });
                }

                const factoresCtx = document.getElementById('factoresChart').getContext('2d');
                if (!factoresChart) {
                    factoresChart = new Chart(factoresCtx, {
                        type: 'radar',
                        data: {
                            labels: ['Seguridad', 'Rastreo GPS', 'Costo', 'Facilidad de Uso', 'Diseño'],
                            datasets: [{
                                label: 'Importancia Valorada (1-5)',
                                data: [5, 4.8, 3.5, 4.2, 3.8],
                                backgroundColor: 'rgba(255, 204, 0, 0.2)',
                                borderColor: chartColors.primary,
                                pointBackgroundColor: chartColors.primary,
                                pointBorderColor: '#fff',
                                pointHoverBackgroundColor: '#fff',
                                pointHoverBorderColor: chartColors.primary,
                                borderWidth: 2
                            }]
                        },
                        options: {
                            ...commonChartOptions,
                            plugins: {
                                ...commonChartOptions.plugins,
                                legend: {
                                    position: 'top',
                                }
                            },
                            scales: {
                                r: {
                                    angleLines: { color: 'rgba(255, 255, 255, 0.2)' },
                                    grid: { color: 'rgba(255, 255, 255, 0.2)' },
                                    pointLabels: {
                                        font: { family: 'Poppins', size: 14, weight: '600' },
                                        color: '#E0E0E0'
                                    },
                                    ticks: { display: false, beginAtZero: true, max: 5, stepSize: 1 },
                                    suggestedMin: 0,
                                    suggestedMax: 5
                                }
                            }
                        }
                    });
                }

                document.getElementById('totalParticipantesText').textContent = `${totalParticipantes} participantes`;
                document.getElementById('interesRastreoText').textContent = `${porcentajeInteresRastreo}% de los encuestados`;
                document.getElementById('pago300500Text').textContent = `${porcentajePago300500}% de los participantes`;
                document.getElementById('pago0300Text').textContent = `${porcentajePago0300}% está dispuesto a pagar entre 0 y 300 USD`;
                document.getElementById('expandirText').textContent = `${porcentajeExpandir}% de los encuestados`;

            } catch (error) {
                console.error('Error al cargar o procesar los datos de la encuesta:', error);
            }
        }

        fetchAndProcessData();
        setInterval(fetchAndProcessData, 30000);
    </script>
    <script>
        // JavaScript para el menú hamburguesa (GLOBAL PARA AMBAS PÁGINAS)
        document.addEventListener('DOMContentLoaded', () => {
            const menuIcon = document.getElementById('menuIcon');
            const mobileNavOverlay = document.getElementById('mobileNavOverlay');
            const navItems = mobileNavOverlay.querySelectorAll('.mobile-nav-item');

            menuIcon.addEventListener('click', () => {
                mobileNavOverlay.classList.toggle('is-open');
                document.body.classList.toggle('menu-active');
                menuIcon.querySelector('i').classList.toggle('fa-bars');
                menuIcon.querySelector('i').classList.toggle('fa-times');
            });

            navItems.forEach(item => {
                item.addEventListener('click', () => {
                    mobileNavOverlay.classList.remove('is-open');
                    document.body.classList.remove('menu-active');
                    menuIcon.querySelector('i').classList.remove('fa-times');
                    menuIcon.querySelector('i').classList.add('fa-bars');
                });
            });

            document.body.addEventListener('click', (event) => {
                if (mobileNavOverlay.classList.contains('is-open') &&
                    !mobileNavOverlay.contains(event.target) &&
                    !menuIcon.contains(event.target)) {

                    mobileNavOverlay.classList.remove('is-open');
                    document.body.classList.remove('menu-active');
                    menuIcon.querySelector('i').classList.remove('fa-times');
                    menuIcon.querySelector('i').classList.add('fa-bars');
                }
            });
        });
    </script>
</body>
</html>